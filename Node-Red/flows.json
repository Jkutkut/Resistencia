[{"id":"3ee4a50f.d7fd0a","type":"tab","label":"Add to DataBase","disabled":false,"info":""},{"id":"e024e963.c4ad88","type":"http in","z":"3ee4a50f.d7fd0a","name":"","url":"/createPlayer.php","method":"post","upload":true,"swaggerDoc":"","x":140,"y":400,"wires":[["991c8d.2321337"]]},{"id":"c749d650.a0bfb8","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'Players' (\n\t'pId' INTEGER PRIMARY KEY AUTOINCREMENT,\n\t'name' VARCHAR,\n\t'groupPos' INT DEFAULT NULL,\n\t'pType' INT DEFAULT 0\n);\n","name":"Create Players table","x":306,"y":58,"wires":[["695efddd.b56fb4"]]},{"id":"e60b12c1.93bb3","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"","payload":"Started!","payloadType":"str","x":126,"y":58,"wires":[["c749d650.a0bfb8"]]},{"id":"32422764.0b24c8","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Add playerName to Players table","x":820,"y":400,"wires":[["aeccccbe.c3651"]]},{"id":"3238142f.bab64c","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Players;","name":"Elements on players List","x":390,"y":1060,"wires":[["22d63c4a.f482f4"]]},{"id":"4fec79f9.70e158","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":170,"y":1060,"wires":[["3238142f.bab64c"]]},{"id":"d0a7d8c3.560628","type":"http in","z":"3ee4a50f.d7fd0a","name":"","url":"/addImg.php","method":"post","upload":true,"swaggerDoc":"","x":130,"y":600,"wires":[["4eb0994a.abcda8"]]},{"id":"b482030f.21609","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO Players ('name') values (\"{{user}}\");","output":"str","x":600,"y":400,"wires":[["32422764.0b24c8","326457be.bbc4d8"]]},{"id":"aea19364.428f5","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"user","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":340,"wires":[]},{"id":"326457be.bbc4d8","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":340,"wires":[]},{"id":"bebbf5c3.e6f7c8","type":"template","z":"3ee4a50f.d7fd0a","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Player created: {{user}}","output":"str","x":1090,"y":520,"wires":[["6a7be78a.149938"]]},{"id":"aeccccbe.c3651","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT pId FROM Players WHERE name = '{{user}}'","output":"str","x":600,"y":460,"wires":[["171f5cd2.8a69c3","326457be.bbc4d8"]]},{"id":"991c8d.2321337","type":"change","z":"3ee4a50f.d7fd0a","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":400,"wires":[["aea19364.428f5","b482030f.21609"]]},{"id":"171f5cd2.8a69c3","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get pId","x":740,"y":460,"wires":[["a9b2165f.bf0f98"]]},{"id":"22d63c4a.f482f4","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":624,"y":1149,"wires":[]},{"id":"c6dd8369.83d07","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Imgs;","name":"Elements on Imgs List","x":380,"y":1120,"wires":[["22d63c4a.f482f4"]]},{"id":"89c682dc.10d91","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":1120,"wires":[["c6dd8369.83d07"]]},{"id":"ef757fa9.1b623","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Opinion;","name":"Elements on Opinion List","x":390,"y":1180,"wires":[["22d63c4a.f482f4"]]},{"id":"75fcac30.a40d84","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":1180,"wires":[["ef757fa9.1b623"]]},{"id":"695efddd.b56fb4","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'Opinion' (\n\t'pId' INTEGER PRIMARY KEY,\n\t'val' INTEGER DEFAULT 0\n);","name":"Create Opinion table","x":527,"y":58,"wires":[["339be272.64cffe"]]},{"id":"f47c840c.f85e88","type":"template","z":"3ee4a50f.d7fd0a","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Img stored and linked","output":"str","x":1090,"y":720,"wires":[["6a7be78a.149938"]]},{"id":"6a7be78a.149938","type":"http response","z":"3ee4a50f.d7fd0a","name":"Send response","statusCode":"","headers":{},"x":1400,"y":600,"wires":[]},{"id":"4ca8aeee.b889f","type":"http in","z":"3ee4a50f.d7fd0a","name":"","url":"/changeOpinion.php","method":"post","upload":true,"swaggerDoc":"","x":150,"y":860,"wires":[["77b9bd32.a21554","1fb9aa6f.5d4706"]]},{"id":"9851184b.a7b988","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Update vote","x":750,"y":919,"wires":[["356bab9a.e79fe4","bd65e4dd.b56338"]]},{"id":"8a9bed91.4e752","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"user","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":820,"wires":[]},{"id":"642ec068.c284f","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":880,"wires":[]},{"id":"77b9bd32.a21554","type":"change","z":"3ee4a50f.d7fd0a","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":860,"wires":[["8a9bed91.4e752","6b9bae33.e6de"]]},{"id":"356bab9a.e79fe4","type":"template","z":"3ee4a50f.d7fd0a","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Succeed","output":"str","x":1110,"y":920,"wires":[["6a7be78a.149938"]]},{"id":"6b9bae33.e6de","type":"change","z":"3ee4a50f.d7fd0a","name":"Save Opinion as msg.opinion","rules":[{"t":"set","p":"opinion","pt":"msg","to":"payload.opinion","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":919,"wires":[["932099d1.1f4148","c8a89d75.4b99a"]]},{"id":"4eb0994a.abcda8","type":"change","z":"3ee4a50f.d7fd0a","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":600,"wires":[["45e9f5c3.1f4a8c","c04d3519.ddccb8"]]},{"id":"45e9f5c3.1f4a8c","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"user","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":600,"wires":[]},{"id":"607de5ed.4feeec","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT pId FROM Players WHERE name = '{{user}}'","output":"str","x":700,"y":660,"wires":[["dcb57df6.3196b","c235eb3.002f018"]]},{"id":"dcb57df6.3196b","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get player pId","x":860,"y":660,"wires":[["a75a4525.275248"]]},{"id":"a16b49f6.4c2698","type":"file","z":"3ee4a50f.d7fd0a","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":850,"y":720,"wires":[["f47c840c.f85e88"]]},{"id":"c235eb3.002f018","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":820,"y":600,"wires":[]},{"id":"15797461.a6cbac","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"filename","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":780,"wires":[]},{"id":"c04d3519.ddccb8","type":"change","z":"3ee4a50f.d7fd0a","name":"Save img","rules":[{"t":"set","p":"img","pt":"msg","to":"payload.img","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":660,"wires":[["607de5ed.4feeec"]]},{"id":"56cae460.d8aa9c","type":"change","z":"3ee4a50f.d7fd0a","name":"Get img","rules":[{"t":"set","p":"payload","pt":"msg","to":"img","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":720,"wires":[["a16b49f6.4c2698","c7e93643.f35868"]]},{"id":"a75a4525.275248","type":"function","z":"3ee4a50f.d7fd0a","name":"get filename","func":"msg.filename = \"/tmp/userIcons/userIcon\" + msg.user + msg.payload[0].pId + \".png\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":720,"wires":[["56cae460.d8aa9c","15797461.a6cbac"]]},{"id":"9a1b58b.4e288a8","type":"function","z":"3ee4a50f.d7fd0a","name":"update topic (debug msg)","func":"msg.topic = \"Database created\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":60,"wires":[["aabe3c03.c99b6"]]},{"id":"aabe3c03.c99b6","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1329,"y":60,"wires":[]},{"id":"c7e93643.f35868","type":"image","z":"3ee4a50f.d7fd0a","name":"","width":160,"data":"payload","dataType":"msg","thumbnail":false,"active":true,"pass":false,"outputs":0,"x":940,"y":780,"wires":[]},{"id":"932099d1.1f4148","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"opinion","targetType":"msg","statusVal":"","statusType":"auto","x":610,"y":960,"wires":[]},{"id":"1fb9aa6f.5d4706","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":330,"y":820,"wires":[]},{"id":"c8a89d75.4b99a","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE Opinion SET val = '{{opinion}}' WHERE pId = (SELECT pId from Players WHERE name = '{{user}}');","output":"str","x":600,"y":919,"wires":[["9851184b.a7b988","642ec068.c284f"]]},{"id":"bd65e4dd.b56338","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":960,"wires":[]},{"id":"2e0a2639.c0c08a","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Add playerName to opinion table","x":810,"y":520,"wires":[["bebbf5c3.e6f7c8"]]},{"id":"a9b2165f.bf0f98","type":"change","z":"3ee4a50f.d7fd0a","name":"Save pId","rules":[{"t":"set","p":"pId","pt":"msg","to":"payload[0].pId","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":460,"wires":[["dfadad4d.9e61a"]]},{"id":"dfadad4d.9e61a","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO Opinion ('pId') values ({{msg.pId}});","output":"str","x":600,"y":520,"wires":[["2e0a2639.c0c08a"]]},{"id":"f288648a.460b28","type":"template","z":"3ee4a50f.d7fd0a","name":"debugCommand","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO Opinion ('pId') values (5);","output":"str","x":1030,"y":1160,"wires":[["48a1405d.80b1e"]]},{"id":"48a1405d.80b1e","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"debugQuerry","x":930,"y":1200,"wires":[["d0c8376d.265098"]]},{"id":"d0c8376d.265098","type":"debug","z":"3ee4a50f.d7fd0a","name":"debug","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1070,"y":1200,"wires":[]},{"id":"bc60b885.b810b8","type":"inject","z":"3ee4a50f.d7fd0a","name":"debugTrigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":850,"y":1160,"wires":[["f288648a.460b28"]]},{"id":"339be272.64cffe","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'Missions' (\n\t'mId' INTEGER PRIMARY KEY AUTOINCREMENT,\n\t'active' INT DEFAULT 0,\n\t'leaderId' INT DEFAULT NULL,\n\t'vYes' INT DEFAULT NULL,\n\t'vNo' INT DEFAULT NULL,\n\t'mRes' INT DEFAULT NULL\n);\n","name":"Create Missions table","x":745,"y":58,"wires":[["9a1b58b.4e288a8","e0ad4701.cd37f8"]]},{"id":"f3ba8deb.cb307","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Missions;","name":"Elements on Missions List","x":389,"y":1242,"wires":[["22d63c4a.f482f4"]]},{"id":"3677bb76.358e04","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":164,"y":1242,"wires":[["f3ba8deb.cb307"]]},{"id":"e0ad4701.cd37f8","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"INSERT INTO Missions (active) VALUES (1);","name":"Create Active mission","x":745,"y":104,"wires":[["da65739a.21643"]]},{"id":"da65739a.21643","type":"function","z":"3ee4a50f.d7fd0a","name":"init loop","func":"msg.index = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":925,"y":104,"wires":[["8ab5fcbd.c3b78"]]},{"id":"8ab5fcbd.c3b78","type":"function","z":"3ee4a50f.d7fd0a","name":"from 1 to 5","func":"if (msg.index++ < 5) {\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1095,"y":104,"wires":[["f45e1f7c.efec9"]]},{"id":"f45e1f7c.efec9","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"INSERT INTO Missions (active) VALUES (0);","name":"Create mission not active","x":1315,"y":104,"wires":[["8ab5fcbd.c3b78"]]},{"id":"a5762d7.f21efd","type":"sqlitedb","db":":memory:","mode":"RWC"}]