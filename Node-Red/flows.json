[{"id":"b081fd91.ebbbd","type":"tab","label":"Page Manager","disabled":false,"info":""},{"id":"3ee4a50f.d7fd0a","type":"tab","label":"Add to DataBase","disabled":false,"info":""},{"id":"ae5a.fbf7e1a608","type":"tab","label":"Get from Database","disabled":false,"info":""},{"id":"f3948f39.2753c","type":"tab","label":"FSM","disabled":false,"info":""},{"id":"c2c8771a.4b2268","type":"subflow","name":"Subflow 1","info":"","in":[],"out":[]},{"id":"a5762d7.f21efd","type":"sqlitedb","db":":memory:","mode":"RWC"},{"id":"4db80d36.1f8aa4","type":"file in","z":"b081fd91.ebbbd","name":"JS","filename":"/home/pi/TheResistance/Client/waitingRoom/waitingRoom.js","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":180,"wires":[["8c6c16e7.a23aa8"]]},{"id":"eb6070eb.b7eda","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/waitingRoom:extra","method":"get","upload":false,"swaggerDoc":"","x":150,"y":140,"wires":[["f942f1d6.ca295"]]},{"id":"bcb7cbb6.527488","type":"change","z":"b081fd91.ebbbd","name":"Save HTML","rules":[{"t":"set","p":"html","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":140,"wires":[["4db80d36.1f8aa4"]]},{"id":"785d8381.488e5c","type":"http response","z":"b081fd91.ebbbd","name":"","x":1230,"y":240,"wires":[]},{"id":"f942f1d6.ca295","type":"file in","z":"b081fd91.ebbbd","name":"HTML","filename":"/home/pi/TheResistance/Client/waitingRoom/waitingRoom.html","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":140,"wires":[["bcb7cbb6.527488"]]},{"id":"2b5e6694.3f8c1a","type":"file in","z":"b081fd91.ebbbd","name":"CommonJS","filename":"/home/pi/TheResistance/Res/JS/common.js","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":690,"y":200,"wires":[["4b6851c8.78e19"]]},{"id":"2dffea04.0b7406","type":"file in","z":"b081fd91.ebbbd","name":"Stryle.css","filename":"/home/pi/TheResistance/Res/CSS/style.css","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":700,"y":240,"wires":[["a1537f3e.e9547"]]},{"id":"a6f6fde6.0d4e2","type":"change","z":"b081fd91.ebbbd","name":"Replace code links","rules":[{"t":"set","p":"payload","pt":"msg","to":"html","tot":"flow"},{"t":"change","p":"payload","pt":"msg","from":"<link rel=\"stylesheet\" href=\"../../Res/CSS/style.css\">","fromt":"str","to":"<style>s</style>","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"(?<=<style>)s(?=<\\/style>)","fromt":"re","to":"styleCss","tot":"flow"},{"t":"change","p":"payload","pt":"msg","from":"<script src=\"../../Res/JS/common.js\"></script>","fromt":"str","to":"<script>c</script>","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"(?<=<script>)c(?=<\\/script>)","fromt":"re","to":"commonJS","tot":"flow"},{"t":"change","p":"payload","pt":"msg","from":"<script src=\"[A-Za-z]+.js\"><\\/script>","fromt":"re","to":"<script>w</script>","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"(?<=<script>)w(?=<\\/script>)","fromt":"re","to":"jscode","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":240,"wires":[["785d8381.488e5c"]]},{"id":"8c6c16e7.a23aa8","type":"change","z":"b081fd91.ebbbd","name":"Save JS","rules":[{"t":"set","p":"jscode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":180,"wires":[["2b5e6694.3f8c1a"]]},{"id":"4b6851c8.78e19","type":"change","z":"b081fd91.ebbbd","name":"Save CommonJS","rules":[{"t":"set","p":"commonJS","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":200,"wires":[["2dffea04.0b7406"]]},{"id":"a1537f3e.e9547","type":"change","z":"b081fd91.ebbbd","name":"Save Style.css","rules":[{"t":"set","p":"styleCss","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":240,"wires":[["a6f6fde6.0d4e2"]]},{"id":"e4ceabba.2eac28","type":"file in","z":"b081fd91.ebbbd","name":"JS","filename":"/home/pi/TheResistance/Client/mainMenu/mainMenu.js","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":380,"wires":[["5a7cda93.547cb4"]]},{"id":"f99d6b51.a39928","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/mainMenu:extra","method":"get","upload":false,"swaggerDoc":"","x":140,"y":340,"wires":[["d99162a5.add29"]]},{"id":"4211a33.e18775c","type":"change","z":"b081fd91.ebbbd","name":"Save HTML","rules":[{"t":"set","p":"html","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":340,"wires":[["e4ceabba.2eac28"]]},{"id":"d99162a5.add29","type":"file in","z":"b081fd91.ebbbd","name":"HTML","filename":"/home/pi/TheResistance/Client/mainMenu/mainMenu.html","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":340,"wires":[["4211a33.e18775c"]]},{"id":"5a7cda93.547cb4","type":"change","z":"b081fd91.ebbbd","name":"Save JS","rules":[{"t":"set","p":"jscode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":380,"wires":[["2b5e6694.3f8c1a"]]},{"id":"9f781407.3450d8","type":"file in","z":"b081fd91.ebbbd","name":"JS","filename":"/home/pi/TheResistance/Client/rootMenu/rootMenu.js","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":260,"wires":[["4379a1a4.b6ec9"]]},{"id":"c7223621.2198a8","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/rootMenu:extra","method":"get","upload":false,"swaggerDoc":"","x":130,"y":220,"wires":[["6fd4e4ab.de0c9c"]]},{"id":"fd503f4a.1712a","type":"change","z":"b081fd91.ebbbd","name":"Save HTML","rules":[{"t":"set","p":"html","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":220,"wires":[["9f781407.3450d8"]]},{"id":"6fd4e4ab.de0c9c","type":"file in","z":"b081fd91.ebbbd","name":"HTML","filename":"/home/pi/TheResistance/Client/rootMenu/rootMenu.html","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":220,"wires":[["fd503f4a.1712a"]]},{"id":"4379a1a4.b6ec9","type":"change","z":"b081fd91.ebbbd","name":"Save JS","rules":[{"t":"set","p":"jscode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":260,"wires":[["2b5e6694.3f8c1a"]]},{"id":"c6fd3033.bc9dc","type":"file in","z":"b081fd91.ebbbd","name":"JS","filename":"/home/pi/TheResistance/Client/createPlayer/createPlayer.js","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":100,"wires":[["163cf40b.c0f69c"]]},{"id":"d1e60e43.00faf","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/createPlayer","method":"get","upload":false,"swaggerDoc":"","x":130,"y":60,"wires":[["ec4edf85.76abc"]]},{"id":"ff19bbd0.060278","type":"change","z":"b081fd91.ebbbd","name":"Save HTML","rules":[{"t":"set","p":"html","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":60,"wires":[["c6fd3033.bc9dc"]]},{"id":"ec4edf85.76abc","type":"file in","z":"b081fd91.ebbbd","name":"HTML","filename":"/home/pi/TheResistance/Client/createPlayer/createPlayer.html","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":60,"wires":[["ff19bbd0.060278"]]},{"id":"163cf40b.c0f69c","type":"change","z":"b081fd91.ebbbd","name":"Save JS","rules":[{"t":"set","p":"jscode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":100,"wires":[["2b5e6694.3f8c1a"]]},{"id":"a4a57b89.9935f8","type":"debug","z":"b081fd91.ebbbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":558,"y":680,"wires":[]},{"id":"5a5de0b8.bc347","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/Res/:type/:content","method":"get","upload":false,"swaggerDoc":"","x":141,"y":584,"wires":[["31277ac5.bd2f06"]]},{"id":"ebd5aa2a.6ec738","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/Res/:type/:subtype/:content","method":"get","upload":false,"swaggerDoc":"","x":171,"y":664,"wires":[["31277ac5.bd2f06"]]},{"id":"1e8ebb5e.eec3a5","type":"image","z":"b081fd91.ebbbd","name":"","width":160,"data":"payload","dataType":"msg","thumbnail":false,"active":false,"pass":false,"outputs":0,"x":779,"y":684,"wires":[]},{"id":"c63e6c67.03d1","type":"http response","z":"b081fd91.ebbbd","name":"","x":731,"y":620,"wires":[]},{"id":"d1e00c12.cf8e7","type":"catch","z":"b081fd91.ebbbd","name":"","scope":null,"uncaught":false,"x":401,"y":744,"wires":[["982e7120.4806f"]]},{"id":"982e7120.4806f","type":"function","z":"b081fd91.ebbbd","name":"Set 404","func":"msg.payload = msg.error;\nmsg.statusCode = 404;//resource not found\nreturn msg;","outputs":1,"noerr":0,"x":548,"y":744,"wires":[["c63e6c67.03d1","a4a57b89.9935f8"]]},{"id":"cb7e0905.952388","type":"file in","z":"b081fd91.ebbbd","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":591,"y":619,"wires":[["c63e6c67.03d1","1e8ebb5e.eec3a5"]]},{"id":"31277ac5.bd2f06","type":"function","z":"b081fd91.ebbbd","name":"","func":"let basicURL = \"/home/pi/TheResistance/Res/\";\nlet content = msg.req.params.type + \"/\";\nif (msg.req.params.subtype) {\n    content += msg.req.params.subtype + \"/\";\n}\ncontent += msg.req.params.content;\n\nif (content.includes(\"..\")) {\n    msg.payload = \"Illegal file path\";\n    msg.statusCode = 405;//not allowed\n    return [null, msg];//fire output 2\n}\n\nmsg.filename = basicURL + content;\n\nmsg.headers = {};\n\nif (/\\.png$/.test(content)) {\n    msg.headers[\"content-type\"] = \"image/png\";\n}\nelse if (/\\.jpeg$/.test(content)) {\n    msg.headers[\"content-type\"] = \"image/jpeg\";\n}\n\n\nreturn [msg, null];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":401,"y":624,"wires":[["cb7e0905.952388"],["a4a57b89.9935f8"]]},{"id":"e024e963.c4ad88","type":"http in","z":"3ee4a50f.d7fd0a","name":"","url":"/createPlayer.php","method":"post","upload":true,"swaggerDoc":"","x":140,"y":400,"wires":[["991c8d.2321337"]]},{"id":"c749d650.a0bfb8","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'Players' (\n\t'pId' INTEGER PRIMARY KEY AUTOINCREMENT,\n\t'name' VARCHAR,\n\t'groupPos' INT DEFAULT NULL,\n\t'pType' INT DEFAULT 0\n);\n","name":"Create Players table","x":306,"y":58,"wires":[["695efddd.b56fb4"]]},{"id":"e60b12c1.93bb3","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"","payload":"Started!","payloadType":"str","x":126,"y":58,"wires":[["c749d650.a0bfb8"]]},{"id":"32422764.0b24c8","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Add playerName to Players table","x":820,"y":400,"wires":[["aeccccbe.c3651"]]},{"id":"3238142f.bab64c","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Players;","name":"Elements on players List","x":390,"y":1060,"wires":[["22d63c4a.f482f4"]]},{"id":"4fec79f9.70e158","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":170,"y":1060,"wires":[["3238142f.bab64c"]]},{"id":"d0a7d8c3.560628","type":"http in","z":"3ee4a50f.d7fd0a","name":"","url":"/addImg.php","method":"post","upload":true,"swaggerDoc":"","x":130,"y":600,"wires":[["4eb0994a.abcda8"]]},{"id":"b482030f.21609","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO Players ('name') values (\"{{user}}\");","output":"str","x":600,"y":400,"wires":[["32422764.0b24c8"]]},{"id":"aea19364.428f5","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"user","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":340,"wires":[]},{"id":"bebbf5c3.e6f7c8","type":"template","z":"3ee4a50f.d7fd0a","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Player created: {{user}}","output":"str","x":1090,"y":520,"wires":[["6a7be78a.149938"]]},{"id":"aeccccbe.c3651","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT pId FROM Players WHERE name = '{{user}}'","output":"str","x":600,"y":460,"wires":[["171f5cd2.8a69c3"]]},{"id":"991c8d.2321337","type":"change","z":"3ee4a50f.d7fd0a","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":400,"wires":[["aea19364.428f5","b482030f.21609"]]},{"id":"171f5cd2.8a69c3","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get pId","x":740,"y":460,"wires":[["a9b2165f.bf0f98"]]},{"id":"22d63c4a.f482f4","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":624,"y":1149,"wires":[]},{"id":"c6dd8369.83d07","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Imgs;","name":"Elements on Imgs List","x":380,"y":1120,"wires":[["22d63c4a.f482f4"]]},{"id":"89c682dc.10d91","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":1120,"wires":[["c6dd8369.83d07"]]},{"id":"ef757fa9.1b623","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Opinion;","name":"Elements on Opinion List","x":390,"y":1180,"wires":[["22d63c4a.f482f4"]]},{"id":"75fcac30.a40d84","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":1180,"wires":[["ef757fa9.1b623"]]},{"id":"695efddd.b56fb4","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'Opinion' (\n\t'pId' INTEGER PRIMARY KEY,\n\t'val' INTEGER DEFAULT 0\n);","name":"Create Opinion table","x":527,"y":58,"wires":[["339be272.64cffe"]]},{"id":"f47c840c.f85e88","type":"template","z":"3ee4a50f.d7fd0a","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Img stored and linked","output":"str","x":1090,"y":720,"wires":[["6a7be78a.149938"]]},{"id":"6a7be78a.149938","type":"http response","z":"3ee4a50f.d7fd0a","name":"Send response","statusCode":"","headers":{},"x":1400,"y":600,"wires":[]},{"id":"4ca8aeee.b889f","type":"http in","z":"3ee4a50f.d7fd0a","name":"","url":"/changeOpinion.php","method":"post","upload":true,"swaggerDoc":"","x":150,"y":860,"wires":[["77b9bd32.a21554","1fb9aa6f.5d4706"]]},{"id":"9851184b.a7b988","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Update vote","x":750,"y":919,"wires":[["356bab9a.e79fe4","bd65e4dd.b56338"]]},{"id":"8a9bed91.4e752","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"user","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":820,"wires":[]},{"id":"642ec068.c284f","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":880,"wires":[]},{"id":"77b9bd32.a21554","type":"change","z":"3ee4a50f.d7fd0a","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":860,"wires":[["8a9bed91.4e752","6b9bae33.e6de"]]},{"id":"356bab9a.e79fe4","type":"template","z":"3ee4a50f.d7fd0a","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Succeed","output":"str","x":1110,"y":920,"wires":[["6a7be78a.149938"]]},{"id":"6b9bae33.e6de","type":"change","z":"3ee4a50f.d7fd0a","name":"Save Opinion as msg.opinion","rules":[{"t":"set","p":"opinion","pt":"msg","to":"payload.opinion","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":919,"wires":[["932099d1.1f4148","c8a89d75.4b99a"]]},{"id":"48a892ea.b7576c","type":"debug","z":"ae5a.fbf7e1a608","name":"","active":true,"console":"false","complete":"false","x":2365,"y":591,"wires":[]},{"id":"f8d56b3b.3bb1f8","type":"image","z":"ae5a.fbf7e1a608","name":"","width":160,"data":"payload","dataType":"msg","thumbnail":false,"active":true,"outputs":0,"x":1260,"y":80,"wires":[]},{"id":"7e6df6c0.483488","type":"debug","z":"ae5a.fbf7e1a608","name":"","active":true,"console":"false","complete":"false","x":2365,"y":631,"wires":[]},{"id":"4eb0994a.abcda8","type":"change","z":"3ee4a50f.d7fd0a","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":600,"wires":[["45e9f5c3.1f4a8c","c04d3519.ddccb8"]]},{"id":"45e9f5c3.1f4a8c","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"user","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":600,"wires":[]},{"id":"607de5ed.4feeec","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT pId FROM Players WHERE name = '{{user}}'","output":"str","x":700,"y":660,"wires":[["dcb57df6.3196b","c235eb3.002f018"]]},{"id":"dcb57df6.3196b","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get player pId","x":860,"y":660,"wires":[["a75a4525.275248"]]},{"id":"a16b49f6.4c2698","type":"file","z":"3ee4a50f.d7fd0a","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":850,"y":720,"wires":[["f47c840c.f85e88"]]},{"id":"c235eb3.002f018","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":820,"y":600,"wires":[]},{"id":"15797461.a6cbac","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"filename","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":780,"wires":[]},{"id":"c04d3519.ddccb8","type":"change","z":"3ee4a50f.d7fd0a","name":"Save img","rules":[{"t":"set","p":"img","pt":"msg","to":"payload.img","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":660,"wires":[["607de5ed.4feeec"]]},{"id":"56cae460.d8aa9c","type":"change","z":"3ee4a50f.d7fd0a","name":"Get img","rules":[{"t":"set","p":"payload","pt":"msg","to":"img","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":720,"wires":[["a16b49f6.4c2698","c7e93643.f35868"]]},{"id":"a75a4525.275248","type":"function","z":"3ee4a50f.d7fd0a","name":"get filename","func":"msg.filename = \"/tmp/userIcons/userIcon\" + msg.user + msg.payload[0].pId + \".png\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":720,"wires":[["56cae460.d8aa9c","15797461.a6cbac"]]},{"id":"4d4c089.b361bf8","type":"http in","z":"ae5a.fbf7e1a608","name":"","url":"/getImg.php","method":"get","upload":true,"swaggerDoc":"","x":120,"y":120,"wires":[["ee89c25a.03cd8"]]},{"id":"c6a4487f.dd6868","type":"debug","z":"ae5a.fbf7e1a608","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":530,"y":60,"wires":[]},{"id":"ee89c25a.03cd8","type":"change","z":"ae5a.fbf7e1a608","name":"Save UserName as msg.user","rules":[{"t":"set","p":"user","pt":"msg","to":"payload.name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":120,"wires":[["c6a4487f.dd6868","92d34976.6adba8"]]},{"id":"92d34976.6adba8","type":"template","z":"ae5a.fbf7e1a608","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT pId from Players WHERE name = '{{user}}';","output":"str","x":540,"y":120,"wires":[["a93829ab.1c00e8","2c1b2c8c.b8e8f4"]]},{"id":"a93829ab.1c00e8","type":"sqlite","z":"ae5a.fbf7e1a608","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get pId","x":680,"y":120,"wires":[["c0d1b3f6.b4cc3"]]},{"id":"c0d1b3f6.b4cc3","type":"change","z":"ae5a.fbf7e1a608","name":"Save pId","rules":[{"t":"set","p":"pId","pt":"msg","to":"payload[0].pId","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":120,"wires":[["247a848f.b3b08c"]]},{"id":"2c1b2c8c.b8e8f4","type":"debug","z":"ae5a.fbf7e1a608","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":60,"wires":[]},{"id":"247a848f.b3b08c","type":"function","z":"ae5a.fbf7e1a608","name":"get filename","func":"msg.filename = \"/tmp/userIcons/userIcon\" + msg.user + msg.pId + \".png\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":120,"wires":[["c0071a2c.504f48"]]},{"id":"c0071a2c.504f48","type":"file in","z":"ae5a.fbf7e1a608","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":1120,"y":120,"wires":[["f8d56b3b.3bb1f8","94959a30.cae2d8"]]},{"id":"4e1d8a2c.17e6e4","type":"http in","z":"ae5a.fbf7e1a608","name":"","url":"/players","method":"get","upload":true,"swaggerDoc":"","x":110,"y":240,"wires":[["e12332a2.e842d"]]},{"id":"e12332a2.e842d","type":"template","z":"ae5a.fbf7e1a608","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * from Players;","output":"str","x":260,"y":240,"wires":[["1417bd61.8d01d3"]]},{"id":"1417bd61.8d01d3","type":"sqlite","z":"ae5a.fbf7e1a608","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get Player table","x":420,"y":240,"wires":[["94959a30.cae2d8"]]},{"id":"499e8414.30635c","type":"inject","z":"f3948f39.2753c","name":"Started","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"init of FSM","payload":"","payloadType":"date","x":220,"y":40,"wires":[["c90835f5.3765d8"]]},{"id":"da5dcf03.c4bc5","type":"debug","z":"f3948f39.2753c","name":"FSM created","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":540,"y":40,"wires":[]},{"id":"c90835f5.3765d8","type":"function","z":"f3948f39.2753c","name":"INIT FSM","func":"const STATES = {\n    SETUP: 0,\n    MEETUP: 1,\n    ROUND: 2,\n    POLLM: 3,\n    MISSION: 4,\n    ENDM: 5,\n    0: \"Setup\",\n    1: \"Meetup\",\n    2: \"Round\",\n    3: \"PollM\",\n    4: \"Mission\",\n    5: \"EndM\"\n}\n\nconst FUNCT = {\n    emptyF: function() {return;},\n    \n    // SETUP\n    startedGame: function() {return;},\n    go2meetup: function() {return;},\n    \n    // MEETUP\n    meetupDelay: function() {return;},\n    go2newRound: function() {return;},\n    \n    // ROUND\n    pollEnded: function() {return;},\n    pollEndedRoot: function() {return;},\n\n    // POLLM\n    good2go: function() {return;},\n    multipleFails: function() {return;},\n    fail: function() {return;},\n    endMission: function() {return;},\n    startMission: function() {return;},\n\n    // MISSION\n    missionEnded: function() {return;},\n    missionEndedRoot: function() {return;},\n\n    // ENDM\n    isEndGame: function() {return;},\n    endGame: function() {return;}\n}\n\nglobal.set(\"currentState\", STATES.SETUP);\nglobal.set(\"STATES\", STATES);\n\n\nglobal.set(\"fsmMatrix\", {});\n\nglobal.get(\"fsmMatrix\")[STATES.SETUP] = [\n    {\n        condition: FUNCT.emptyF, // Waiting for root to start\n        to: STATES.SETUP, // SAME\n        exe: FUNCT.emptyF // Just wait\n    },\n    {\n        condition: FUNCT.startedGame, // If game started by root\n        to: STATES.MEETUP, // Start meetup\n        exe: FUNCT.go2meetup // Start meetup\n    }\n];\nglobal.get(\"fsmMatrix\")[STATES.MEETUP] = [\n    {\n        condition: FUNCT.emptyF, // Waiting\n        to: STATES.MEETUP, // SAME\n        exe: FUNCT.emptyF // Just wait\n    },\n    {\n        condition: FUNCT.meetupDelay, // Wait until the time ends\n        to: STATES.ROUND, // Start new round\n        exe: FUNCT.go2newRound // Start new round\n    }\n];\nglobal.get(\"fsmMatrix\")[STATES.ROUND] = [\n    {\n        condition: FUNCT.emptyF, // Waiting\n        to: STATES.ROUND, // SAME\n        exe: FUNCT.emptyF // Just wait\n    },\n    {\n        condition: FUNCT.pollEndedRoot, // if ended by rootMenu\n        to: STATES.POLLM, // Check results\n        exe: FUNCT.emptyF\n    },\n    {\n        condition: FUNCT.pollEnded, // All players have already voted\n        to: STATES.POLLM, // Check results\n        exe: FUNCT.emptyF\n    }\n];\n\n\nglobal.get(\"fsmMatrix\")[STATES.POLLM] = [\n    {\n        condition: FUNCT.good2go,\n        to: STATES.MISSION,\n        exe: FUNCT.startMission\n    },\n    {\n        condition: FUNCT.multipleFails,\n        to: STATES.ENDM,\n        exe: FUNCT.endMission\n    },\n    {\n        condition: FUNCT.fail,\n        to: STATES.ROUND,\n        exe: FUNCT.go2newRound\n    }\n];\n\n\n\nglobal.get(\"fsmMatrix\")[STATES.MISSION] = [\n    {\n        condition: FUNCT.emptyF, // Waiting\n        to: STATES.ROUND, // SAME\n        exe: FUNCT.emptyF // Just wait\n    },\n    {\n        condition: FUNCT.missionEndedRoot, // if ended by rootMenu\n        to: STATES.ENDM, // Update result of the mission\n        exe: FUNCT.emptyF\n    },\n    {\n        condition: FUNCT.missionEnded, // All players have already voted\n        to: STATES.ENDM, // Update result of the mission\n        exe: FUNCT.emptyF\n    }\n];\n\n\nglobal.get(\"fsmMatrix\")[STATES.ENDM] = [\n    {\n        condition: !FUNCT.isEndGame,\n        to: null,\n        exe: FUNCT.endGame\n    },\n    {\n        condition: !FUNCT.isEndGame,\n        to: STATES.ROUND,\n        exe: FUNCT.go2newRound\n    }\n];\n\n\nmsg.topic = \"FSM initialized\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":40,"wires":[["da5dcf03.c4bc5"]]},{"id":"23b59e28.955ff2","type":"http in","z":"f3948f39.2753c","name":"","url":"/startGame","method":"get","upload":false,"swaggerDoc":"","x":220,"y":320,"wires":[["7d08bb9d.4b56b4"]]},{"id":"7d08bb9d.4b56b4","type":"function","z":"f3948f39.2753c","name":"Change State","func":"let STATES = global.get(\"STATES\");\n\nlet state = global.get(\"currentState\");\n\nif (state != STATES.SETUP) {\n    throw \"Can not start the game, the current phase is not valid (\" + PHASES[phase] + \")\"; \n}\nelse {\n    node.warn(\"Changing to meetup\");\n    global.set(\"currentState\", STATES.MEETUP);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":320,"wires":[["fa657030.db7a2"]]},{"id":"1cf5b11e.1604df","type":"catch","z":"f3948f39.2753c","name":"","scope":null,"uncaught":false,"x":960,"y":400,"wires":[["ab2338b1.ba7a08"]]},{"id":"ab2338b1.ba7a08","type":"debug","z":"f3948f39.2753c","name":"","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"error","targetType":"msg","statusVal":"","statusType":"auto","x":1150,"y":400,"wires":[]},{"id":"628bd1c3.ed9df","type":"inject","z":"f3948f39.2753c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":380,"wires":[["7d08bb9d.4b56b4"]]},{"id":"9a1b58b.4e288a8","type":"function","z":"3ee4a50f.d7fd0a","name":"update topic (debug msg)","func":"msg.topic = \"Database created\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":59,"wires":[["aabe3c03.c99b6","f6c5efb2.f7285"]]},{"id":"aabe3c03.c99b6","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1422,"y":59,"wires":[]},{"id":"ae435d20.e9fab","type":"inject","z":"f3948f39.2753c","name":"debug CurrentPhase","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":250,"y":140,"wires":[["1aa8eae.9bdb515"]]},{"id":"1aa8eae.9bdb515","type":"function","z":"f3948f39.2753c","name":"Get currentPhase","func":"const PHASES = global.get(\"STATES\");\nlet phase = global.get(\"currentState\");\n\nmsg.payload = \"Current phase is: \" + PHASES[phase];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":140,"wires":[["dbad9e44.0185c"]]},{"id":"dbad9e44.0185c","type":"debug","z":"f3948f39.2753c","name":"log debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":640,"y":140,"wires":[]},{"id":"525035de.1f9f0c","type":"switch","z":"f3948f39.2753c","name":"If Meetup","property":"currentState","propertyType":"global","rules":[{"t":"eq","v":"STATES.MEETUP","vt":"global"}],"checkall":"false","repair":false,"outputs":1,"x":360,"y":560,"wires":[["4fecd5a2.84834c","c167329f.3f94b"]]},{"id":"4fecd5a2.84834c","type":"function","z":"f3948f39.2753c","name":"Debug","func":"node.warn(\"valid\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":520,"wires":[[]]},{"id":"e3d397fc.fb1ef8","type":"function","z":"f3948f39.2753c","name":"debug","func":"node.warn(\"invalid\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":640,"wires":[[]]},{"id":"c05f941.69d4768","type":"switch","z":"f3948f39.2753c","name":"If not Meetup","property":"currentState","propertyType":"global","rules":[{"t":"neq","v":"STATES.MEETUP","vt":"global"}],"checkall":"false","repair":false,"outputs":1,"x":370,"y":600,"wires":[["7ea6e723.6355f8","e3d397fc.fb1ef8"]]},{"id":"7ea6e723.6355f8","type":"function","z":"f3948f39.2753c","name":"Invalid response","func":"// msg.payload = \"hola\";\nmsg.payload = \"f\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":600,"wires":[["a53863af.9150a"]]},{"id":"a53863af.9150a","type":"http response","z":"f3948f39.2753c","name":"","x":710,"y":580,"wires":[]},{"id":"26e9f1a1.15eeee","type":"http in","z":"f3948f39.2753c","name":"","url":"/canStopWaiting","method":"get","upload":false,"swaggerDoc":"","x":180,"y":580,"wires":[["525035de.1f9f0c","c05f941.69d4768"]]},{"id":"c167329f.3f94b","type":"function","z":"f3948f39.2753c","name":"Valid response","func":"msg.payload = \"t\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":560,"wires":[["a53863af.9150a"]]},{"id":"35365ffa.47cb7","type":"inject","z":"ae5a.fbf7e1a608","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":940,"y":200,"wires":[["6bab2eae.5c311"]]},{"id":"6bab2eae.5c311","type":"function","z":"ae5a.fbf7e1a608","name":"get filename","func":"msg.filename = \"/tmp/userIcons/userIcondbs27.png\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":200,"wires":[["c0071a2c.504f48"]]},{"id":"c7e93643.f35868","type":"image","z":"3ee4a50f.d7fd0a","name":"","width":160,"data":"payload","dataType":"msg","thumbnail":false,"active":true,"pass":false,"outputs":0,"x":940,"y":780,"wires":[]},{"id":"a9ebdb1f.09dd18","type":"function","z":"f3948f39.2753c","name":"Select the chunguitos","func":"/**\n * Retuns the number of enemies in the game\n * @param (number) n - Number of players\n */\nlet chunguitosF = function(n) {\n    switch(n) {\n        case 5:\n        case 6:\n            return 2;\n        case 7:\n        case 8:\n        case 9:\n            return 3;\n        case 10:\n            return 4;\n        default:\n            throw \"The number of players is not valid\";\n    }\n}\n\nlet players = msg.payload; // Array of players\nlet chunguitos = chunguitosF(players.length); // number of chunguitos\nmsg.chunguitos = []; // All the chunguitos pIds will be stored here\n\nlet indices = [];\nwhile (indices.length < chunguitos) {\n    let alreadyIn = false;\n    let newRandom = Math.floor(Math.random() * players.length);\n    for (let i of indices) {\n        if (i == newRandom) {\n            alreadyIn = true;\n            break;\n        }\n    }\n    if (!alreadyIn) {\n        indices.push(newRandom);\n        msg.chunguitos.push(players[newRandom].pId);\n    }\n}\n// node.warn(players);\n// node.warn(msg.chunguitos);\nmsg.chunguitosIndex = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":240,"wires":[["4ad9850b.01bf6c"]]},{"id":"fa657030.db7a2","type":"template","z":"f3948f39.2753c","name":"Get player","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * from Players;","output":"str","x":570,"y":240,"wires":[["ff3949b9.b3e1f8"]]},{"id":"ff3949b9.b3e1f8","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Get Player table","x":740,"y":240,"wires":[["a9ebdb1f.09dd18"]]},{"id":"fecd4126.e64c3","type":"inject","z":"f3948f39.2753c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":390,"y":240,"wires":[["fa657030.db7a2"]]},{"id":"4ad9850b.01bf6c","type":"function","z":"f3948f39.2753c","name":"Create Querry","func":"\nif (msg.chunguitosIndex < msg.chunguitos.length) {\n    msg.topic = \"UPDATE Players SET pType = 1 WHERE pId = \" + msg.chunguitos[msg.chunguitosIndex++];\n    node.warn(msg.topic);\n    return msg;\n}\n// Else, end execution","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":300,"wires":[["5748ef53.3561d"]]},{"id":"5748ef53.3561d","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"","name":"Create chunguito","x":920,"y":300,"wires":[["4ad9850b.01bf6c"]]},{"id":"3c76da14.3394b6","type":"file in","z":"b081fd91.ebbbd","name":"JS","filename":"/home/pi/TheResistance/Client/meetup/meetup.js","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":460,"wires":[["53a3c11.c89f54"]]},{"id":"a9584395.03e9c","type":"http in","z":"b081fd91.ebbbd","name":"","url":"/meetup:extra","method":"get","upload":false,"swaggerDoc":"","x":130,"y":420,"wires":[["65fe749.0329a8c"]]},{"id":"b03313d.50c0cf","type":"change","z":"b081fd91.ebbbd","name":"Save HTML","rules":[{"t":"set","p":"html","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":420,"wires":[["3c76da14.3394b6"]]},{"id":"65fe749.0329a8c","type":"file in","z":"b081fd91.ebbbd","name":"HTML","filename":"/home/pi/TheResistance/Client/meetup/meetup.html","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":330,"y":420,"wires":[["b03313d.50c0cf"]]},{"id":"53a3c11.c89f54","type":"change","z":"b081fd91.ebbbd","name":"Save JS","rules":[{"t":"set","p":"jscode","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":460,"wires":[["2b5e6694.3f8c1a"]]},{"id":"932099d1.1f4148","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"opinion","targetType":"msg","statusVal":"","statusType":"auto","x":610,"y":960,"wires":[]},{"id":"1fb9aa6f.5d4706","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":330,"y":820,"wires":[]},{"id":"c8a89d75.4b99a","type":"template","z":"3ee4a50f.d7fd0a","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"UPDATE Opinion SET val = '{{opinion}}' WHERE pId = (SELECT pId from Players WHERE name = '{{user}}');","output":"str","x":600,"y":919,"wires":[["9851184b.a7b988","642ec068.c284f"]]},{"id":"bd65e4dd.b56338","type":"debug","z":"3ee4a50f.d7fd0a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":960,"wires":[]},{"id":"2e0a2639.c0c08a","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Add playerName to opinion table","x":810,"y":520,"wires":[["bebbf5c3.e6f7c8"]]},{"id":"a9b2165f.bf0f98","type":"change","z":"3ee4a50f.d7fd0a","name":"Save pId","rules":[{"t":"set","p":"pId","pt":"msg","to":"payload[0].pId","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":460,"wires":[["973196eb.fb6c08"]]},{"id":"f288648a.460b28","type":"template","z":"3ee4a50f.d7fd0a","name":"debugCommand","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO Opinion ('pId') values (5);","output":"str","x":1030,"y":1160,"wires":[["48a1405d.80b1e"]]},{"id":"48a1405d.80b1e","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"debugQuerry","x":930,"y":1200,"wires":[["d0c8376d.265098"]]},{"id":"d0c8376d.265098","type":"debug","z":"3ee4a50f.d7fd0a","name":"debug","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1070,"y":1200,"wires":[]},{"id":"bc60b885.b810b8","type":"inject","z":"3ee4a50f.d7fd0a","name":"debugTrigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":850,"y":1160,"wires":[["f288648a.460b28"]]},{"id":"bed677a0.37b238","type":"http in","z":"ae5a.fbf7e1a608","name":"","url":"/pollStatus","method":"get","upload":true,"swaggerDoc":"","x":120,"y":300,"wires":[["c1d10a32.3a9878"]]},{"id":"c1d10a32.3a9878","type":"sqlite","z":"ae5a.fbf7e1a608","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT val from Opinion;","name":"Get Player table","x":300,"y":300,"wires":[["94959a30.cae2d8"]]},{"id":"94959a30.cae2d8","type":"http response","z":"ae5a.fbf7e1a608","name":"","statusCode":"","headers":{},"x":1290,"y":300,"wires":[]},{"id":"339be272.64cffe","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'Missions' (\n\t'mId' INTEGER PRIMARY KEY AUTOINCREMENT,\n\t'active' INT DEFAULT 0,\n\t'leaderId' INT DEFAULT NULL,\n\t'vYes' INT DEFAULT NULL,\n\t'vNo' INT DEFAULT NULL,\n\t'mRes' INT DEFAULT NULL\n);\n","name":"Create Missions table","x":745,"y":58,"wires":[["e0ad4701.cd37f8","4ba100fa.7f46e"]]},{"id":"f3ba8deb.cb307","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Missions;","name":"Elements on Missions List","x":389,"y":1242,"wires":[["22d63c4a.f482f4"]]},{"id":"3677bb76.358e04","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":164,"y":1242,"wires":[["f3ba8deb.cb307"]]},{"id":"e0ad4701.cd37f8","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"INSERT INTO Missions (active) VALUES (1);","name":"Create Active mission","x":745,"y":104,"wires":[["da65739a.21643"]]},{"id":"da65739a.21643","type":"function","z":"3ee4a50f.d7fd0a","name":"init loop","func":"msg.index = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":925,"y":104,"wires":[["8ab5fcbd.c3b78"]]},{"id":"8ab5fcbd.c3b78","type":"function","z":"3ee4a50f.d7fd0a","name":"from 1 to 5","func":"if (msg.index++ < 5) {\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1095,"y":104,"wires":[["f45e1f7c.efec9"]]},{"id":"f45e1f7c.efec9","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"INSERT INTO Missions (active) VALUES (0);","name":"Create mission not active","x":1315,"y":104,"wires":[["8ab5fcbd.c3b78"]]},{"id":"4c692530.1c212c","type":"http in","z":"ae5a.fbf7e1a608","name":"","url":"/missions","method":"get","upload":true,"swaggerDoc":"","x":110,"y":360,"wires":[["1ee5cf6.2dabc31"]]},{"id":"276c8e4c.72cb02","type":"sqlite","z":"ae5a.fbf7e1a608","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * from Missions;","name":"Get Missions table","x":710,"y":360,"wires":[["f6598d4a.f9569"]]},{"id":"4ba100fa.7f46e","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"CREATE TABLE 'MissionTeam' (\n\t'mId' INTEGER,\n\t'pId' INT,\n\t'vote' INT DEFAULT NULL\n);\n","name":"Create MissionTeam table","x":990,"y":59,"wires":[["9a1b58b.4e288a8"]]},{"id":"754d02fc.e5cd6c","type":"sqlite","z":"3ee4a50f.d7fd0a","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM MissionTeam;","name":"Elements on Missions List","x":390,"y":1300,"wires":[["22d63c4a.f482f4"]]},{"id":"e26a7270.ed586","type":"inject","z":"3ee4a50f.d7fd0a","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":166,"y":1300,"wires":[["754d02fc.e5cd6c"]]},{"id":"1ee5cf6.2dabc31","type":"sqlite","z":"ae5a.fbf7e1a608","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * from MissionTeam;","name":"Get MissionTeam table","x":300,"y":360,"wires":[["a711c95b.837638"]]},{"id":"a711c95b.837638","type":"change","z":"ae5a.fbf7e1a608","name":"Store missionTeam","rules":[{"t":"set","p":"missionTeam","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":360,"wires":[["276c8e4c.72cb02"]]},{"id":"f6598d4a.f9569","type":"change","z":"ae5a.fbf7e1a608","name":"Create MissionObject","rules":[{"t":"set","p":"missions","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"payload.missions","pt":"msg","to":"missions","tot":"flow"},{"t":"set","p":"payload.missionTeam","pt":"msg","to":"missionTeam","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":360,"wires":[["94959a30.cae2d8"]]},{"id":"973196eb.fb6c08","type":"function","z":"3ee4a50f.d7fd0a","name":"template","func":"msg.topic = \"INSERT INTO Opinion (pId) VALUES (\" + msg.pId + \");\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":520,"wires":[["2e0a2639.c0c08a"]]},{"id":"f6c5efb2.f7285","type":"function","z":"3ee4a50f.d7fd0a","name":"init autoPlayers","func":"msg.index = 0;\nmsg.players = [\n    {user: \"Jorge\"},\n    {user: \"Paula\"},\n    {user: \"Ana\"},\n    {user: \"Laura\"},\n    {user: \"Adrian\"},\n    {user: \"Tornillo\"}\n];\nmsg.payload = {};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":200,"wires":[["5fb94c72.4231f4"]]},{"id":"5fb94c72.4231f4","type":"function","z":"3ee4a50f.d7fd0a","name":"for each player","func":"if (msg.index < msg.players.length) {\n    msg.payload.name = msg.players[msg.index++].user;\n    // node.warn(msg.players);\n    // node.warn(msg.players[msg.index - 1]);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":200,"wires":[["d07c37b0.aa8a78","991c8d.2321337"]]},{"id":"d07c37b0.aa8a78","type":"function","z":"3ee4a50f.d7fd0a","name":"void","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":200,"wires":[["5fb94c72.4231f4"]]}]