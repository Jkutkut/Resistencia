[{"id":"f3948f39.2753c","type":"tab","label":"FSM","disabled":false,"info":""},{"id":"499e8414.30635c","type":"inject","z":"f3948f39.2753c","name":"Started","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"init of FSM","payload":"","payloadType":"date","x":120,"y":60,"wires":[["c90835f5.3765d8"]]},{"id":"c90835f5.3765d8","type":"function","z":"f3948f39.2753c","name":"INIT FSM","func":"const STATES = {\n    SETUP: 0,\n    ROUND: 1,\n    MISSION: 2,\n    END: 3,\n    0: \"Setup\",\n    1: \"Round\",\n    2: \"Mission\",\n    3: \"End\"\n}\n\nglobal.set(\"currentState\", STATES.SETUP);\nglobal.set(\"STATES\", STATES);\n\nnode.warn(\"FSM initialized\");\n\n\nglobal.set(\"missionFailedTimes\", 0); // Times consecutively the mission poll has failed\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":60,"wires":[[]]},{"id":"23b59e28.955ff2","type":"http in","z":"f3948f39.2753c","name":"","url":"/startGame","method":"post","upload":false,"swaggerDoc":"","x":120,"y":240,"wires":[["7d08bb9d.4b56b4","a5c3989f.652b18"]]},{"id":"7d08bb9d.4b56b4","type":"function","z":"f3948f39.2753c","name":"Change State if valid","func":"let STATES = global.get(\"STATES\");\n\nlet state = global.get(\"currentState\");\n\nif (state != STATES.SETUP) {\n    throw \"Can not start the game, the current state is not valid (\" + STATES[state] + \")\"; \n}\nelse {\n    node.warn(\"Changing to meetup\");\n    global.set(\"currentState\", STATES.ROUND);\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":240,"wires":[["ff3949b9.b3e1f8"]]},{"id":"1cf5b11e.1604df","type":"catch","z":"f3948f39.2753c","name":"","scope":null,"uncaught":false,"x":740,"y":60,"wires":[["ab2338b1.ba7a08","28018874.84f118"]]},{"id":"ab2338b1.ba7a08","type":"debug","z":"f3948f39.2753c","name":"","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"error","targetType":"msg","statusVal":"","statusType":"auto","x":910,"y":100,"wires":[]},{"id":"ae435d20.e9fab","type":"inject","z":"f3948f39.2753c","name":"debug CurrentPhase","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":156,"y":140,"wires":[["1aa8eae.9bdb515"]]},{"id":"1aa8eae.9bdb515","type":"function","z":"f3948f39.2753c","name":"Get currentState","func":"const STATES = global.get(\"STATES\");\nlet state = global.get(\"currentState\");\n\nmsg.payload = \"Current state is: \" + STATES[state];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":346,"y":140,"wires":[["dbad9e44.0185c"]]},{"id":"dbad9e44.0185c","type":"debug","z":"f3948f39.2753c","name":"log debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":546,"y":140,"wires":[]},{"id":"525035de.1f9f0c","type":"switch","z":"f3948f39.2753c","name":"Check FSM","property":"currentState","propertyType":"global","rules":[{"t":"eq","v":"STATES.SETUP","vt":"global"},{"t":"eq","v":"STATES.ROUND","vt":"global"},{"t":"eq","v":"STATES.MISSION","vt":"global"},{"t":"eq","v":"STATES.END","vt":"global"}],"checkall":"false","repair":false,"outputs":4,"x":584,"y":974,"wires":[["7ea6e723.6355f8"],["c167329f.3f94b"],["7e07dab8.9dc3e4"],["3a8e7726.d98b68"]]},{"id":"a53863af.9150a","type":"http response","z":"f3948f39.2753c","name":"","x":1050,"y":1000,"wires":[]},{"id":"26e9f1a1.15eeee","type":"http in","z":"f3948f39.2753c","name":"","url":"/canStopWaiting","method":"get","upload":false,"swaggerDoc":"","x":140,"y":980,"wires":[["bd4f8fa4.971b6"]]},{"id":"c167329f.3f94b","type":"function","z":"f3948f39.2753c","name":"Go to meetup and MainMenu","func":"let s = parseInt(msg.payload.currentState);\nlet STATES = global.get(\"STATES\");\n\nif (s == STATES.SETUP) { // If firstTime\n    msg.payload = \"meetup.html\";    \n}\nelse {\n    msg.payload = \"mainMenu.html\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":960,"wires":[["a53863af.9150a"]]},{"id":"a9ebdb1f.09dd18","type":"function","z":"f3948f39.2753c","name":"Select the chunguitos","func":"/**\n * Retuns the number of enemies in the game\n * @param (number) n - Number of players\n */\nlet chunguitosF = function(n) {\n    switch(n) {\n        case 5:\n        case 6:\n            return 2;\n        case 7:\n        case 8:\n        case 9:\n            return 3;\n        case 10:\n            return 4;\n        default:\n            throw \"The number of players is not valid\";\n    }\n}\n\nlet players = msg.payload; // Array of players\nlet chunguitos = chunguitosF(players.length); // number of chunguitos\nmsg.chunguitos = []; // All the chunguitos pIds will be stored here\n\nlet indices = [];\nwhile (indices.length < chunguitos) {\n    let alreadyIn = false;\n    let newRandom = Math.floor(Math.random() * players.length); // Not +1 because this will be used for array indexing\n    for (let i of indices) {\n        if (i == newRandom) {\n            alreadyIn = true;\n            break;\n        }\n    }\n    if (!alreadyIn) {\n        indices.push(newRandom);\n        try {\n            \n            msg.chunguitos.push(players[newRandom].pId);\n        }\n        catch(e) {\n            node.warn(\"ERROR on pId: index = \" + newRandom);\n            throw e;\n        }\n    }\n}\n\nglobal.set(\"chunguitos\", msg.chunguitos);\n\nmsg.chunguitosIndex = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":296,"wires":[["4ad9850b.01bf6c"]]},{"id":"4ad9850b.01bf6c","type":"function","z":"f3948f39.2753c","name":"Create Querry","func":"\nif (msg.chunguitosIndex < msg.chunguitos.length) {\n    msg.topic = \"UPDATE Players SET pType = 1 WHERE pId = \" + msg.chunguitos[msg.chunguitosIndex++];\n    //node.warn(msg.topic);\n    return [msg, undefined];\n}\nelse {\n    // Else, end execution\n    return [undefined, msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":620,"y":296,"wires":[["5748ef53.3561d"],["719aeadf.127b74"]]},{"id":"719aeadf.127b74","type":"template","z":"f3948f39.2753c","name":"Create response for user device","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Game starting now","output":"str","x":872,"y":357,"wires":[["ff1269fd.2758b8"]]},{"id":"c03fd44e.f144b8","type":"function","z":"f3948f39.2753c","name":"Select the leader","func":"let players = msg.payload; // Array of players\nlet leader_pId = Math.floor(Math.random() * players.length) + 1;\n\nmsg.topic = \"UPDATE Missions SET leaderId = (\" + leader_pId + \") WHERE mId = 1;\";\n\nglobal.set(\"playersLen\", players.length); // Store the number of players in the game\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":240,"wires":[["7c067fa9.b0485"]]},{"id":"a5c3989f.652b18","type":"debug","z":"f3948f39.2753c","name":"log debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"\"Starting game\"","targetType":"jsonata","statusVal":"","statusType":"auto","x":280,"y":200,"wires":[]},{"id":"ff3949b9.b3e1f8","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * from Players;","name":"Get Player table","x":520,"y":240,"wires":[["c03fd44e.f144b8","a9ebdb1f.09dd18"]]},{"id":"5748ef53.3561d","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"","name":"Create chunguito","x":826,"y":296,"wires":[["4ad9850b.01bf6c"]]},{"id":"7c067fa9.b0485","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Update leader of 1ยบ mission","x":940,"y":240,"wires":[[]]},{"id":"28018874.84f118","type":"function","z":"f3948f39.2753c","name":"Return response if needed","func":"if (msg.res) {\n    msg.payload = msg.error;\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":60,"wires":[["1547ae53.7c3c82"]]},{"id":"1547ae53.7c3c82","type":"http response","z":"f3948f39.2753c","name":"","x":1150,"y":60,"wires":[]},{"id":"4540f886.d13858","type":"http in","z":"f3948f39.2753c","name":"","url":"/endPoll","method":"post","upload":false,"swaggerDoc":"","x":110,"y":440,"wires":[["1802c5be.8f10ba"]]},{"id":"1802c5be.8f10ba","type":"function","z":"f3948f39.2753c","name":"Check if currentState valid","func":"let STATES = global.get(\"STATES\");\n\nlet state = global.get(\"currentState\");\n\nif (state != STATES.ROUND) {\n    throw \"Can not end the current poll, the current state is not valid (\" + STATES[state] + \")\"; \n}\n\nnode.warn(\"Ending poll\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":440,"wires":[["e9ec1969.7229c8"]]},{"id":"e9ec1969.7229c8","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Missions WHERE active = 1;","name":"Get current mission","x":290,"y":480,"wires":[["798d20b4.88079"]]},{"id":"ca61e277.542af","type":"debug","z":"f3948f39.2753c","name":"log debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":580,"y":440,"wires":[]},{"id":"798d20b4.88079","type":"function","z":"f3948f39.2753c","name":"store mission","func":"msg.currentMission = msg.payload[0];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":480,"wires":[["ca61e277.542af","58011f02.f8b5d"]]},{"id":"537db9c1.cec818","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"UPDATE Missions SET active = 0 WHERE active = 1;","name":"mission not active now","x":1220,"y":760,"wires":[["a78fcd1.fb22e3"]]},{"id":"d77755fb.383c68","type":"function","z":"f3948f39.2753c","name":"Check if enough players","func":"const playersPerM = {\n    5: [ 2, 3, 2, 3, 3 ],\n    6: [ 2, 3, 4, 3, 4 ],\n    7: [ 2, 3, 3, 4, 4 ],\n    8: [ 3, 4, 4, 5, 5 ],\n    9: [ 3, 4, 4, 5, 5 ],\n    10:[ 3, 4, 4, 5, 5 ]\n}\n\nmsg.teamPlayers = msg.payload; // Store players in missions\nlet teamLen = global.get(\"playersLen\"); // number of players playing\n\nlet maxPlayers = playersPerM[teamLen][msg.currentMission.mId - 1];\n\n\nlet missionTeamLength = 0;\nfor (let p of msg.teamPlayers) { // Count number of players\n    if (p.mId == msg.currentMission.mId) {\n        missionTeamLength++;\n    }\n}\n\nnode.warn(\"Next mission require \" + maxPlayers + \", selected \" + missionTeamLength);\nif (missionTeamLength != maxPlayers) {\n    node.warn(\"Invalid number of players selected, missing \" + (maxPlayers - missionTeamLength));\n    //throw new Error(\"Invalid number of players\");\n}\nelse {\n    node.warn(\"Ready for next phase\");\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":520,"wires":[["b369d090.59276"]]},{"id":"58011f02.f8b5d","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM MissionTeam;","name":"Elements on MissionTeam List","x":330,"y":520,"wires":[["d77755fb.383c68"]]},{"id":"82f94fff.d2b0c","type":"debug","z":"f3948f39.2753c","name":"ENDGAME","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1490,"y":840,"wires":[]},{"id":"b369d090.59276","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Opinion;","name":"Elements on Opinion List","x":310,"y":560,"wires":[["9d59f20a.adc9c"]]},{"id":"9d59f20a.adc9c","type":"function","z":"f3948f39.2753c","name":"Determine poll outcome","func":"msg.opinion = msg.payload; // save opinion table\n\n\nlet pollResult = 0;\nmsg.vYes = 0;\nmsg.vNo = 0;\nfor (let o of msg.opinion) {\n    pollResult += o.val;\n    if (o.val == 1) msg.vYes++;\n    else if (o.val == -1) msg.vNo++;\n}\n\n\nif (pollResult > 0) {\n    node.warn(\"Mission valid, creating team\");\n    return [msg, null]; // Create mission\n}\nelse {\n    node.warn(\"Mission invalid\");\n    return [null, msg];\n}\nreturn msg;","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":560,"wires":[["e26c20ed.28539","5736f0b9.8aeb"],["37b799ae.88bae6","5736f0b9.8aeb"]]},{"id":"5736f0b9.8aeb","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"UPDATE Opinion SET val = 0 WHERE val = 1 or val = -1;","name":"Reset Opinion table","x":850,"y":500,"wires":[[]]},{"id":"ff1269fd.2758b8","type":"http response","z":"f3948f39.2753c","name":"","x":1070,"y":357,"wires":[]},{"id":"7f16269b.a92298","type":"function","z":"f3948f39.2753c","name":"Atempt Enable next Mission","func":"let STATES = global.get(\"STATES\");\n\n\n// Check if GameOver\nmsg.missions = msg.payload;\n\nlet resis = 0, chung = 0, gameResult;\nfor (let m of msg.missions) {\n    if (m.mRes == null) break;\n    else if (m.mRes == 0) resis++;\n    else chung++;\n}\nif (resis >= 3) gameResult = 0;\nelse if (chung >= 3) gameResult = 1;\n\nnode.warn(resis + \" -- \" + chung + \" => \" + gameResult);\n\nif (gameResult != undefined || // If team has won or\n    msg.currentMissionId >= 5) { // If last mission reached, gameOver\n    global.set(\"currentState\", STATES.END); // Change state to endGame\n    global.set(\"gameResult\", gameResult); // Store gameResult\n    node.warn(\"Game ended\");\n    return [null, msg];\n}\nelse { // If now we going to next mission\n    let nextLeaderId = (msg.currentMission.leaderId + 1) % (global.get(\"playersLen\") + 1);\n    if (nextLeaderId == 0) nextLeaderId++; // If 0, real id is 1 \n    node.warn(\"next leader is \" + nextLeaderId);\n    msg.topic = \"UPDATE Missions SET active = 1, leaderId = \" + nextLeaderId + \" WHERE mId = \" + (msg.currentMission.mId + 1);\n    return [msg, null];    \n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1241,"y":807,"wires":[["43fa1d9c.6c34d4"],["82f94fff.d2b0c"]]},{"id":"e26c20ed.28539","type":"function","z":"f3948f39.2753c","name":"Team created","func":"let STATES = global.get(\"STATES\");\n\nglobal.set(\"currentState\", STATES.MISSION); // Change state\n\nglobal.set(\"missionFailedTimes\", 0); // Reset counter\n\nmsg.mRes = \"NULL\";\n\nmsg.topic = \"Team created\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":560,"wires":[["7d98bc44.d312d4","6c23cda7.8caae4"]]},{"id":"37b799ae.88bae6","type":"function","z":"f3948f39.2753c","name":"Handle failed poll","func":"let STATES = global.get(\"STATES\");\n\nglobal.set(\"missionFailedTimes\", global.get(\"missionFailedTimes\") + 1);\n\nif (global.get(\"missionFailedTimes\") < 5) { // If just failed poll, create a new one\n    msg.currentMission.mId--; // one minus to repeat mission\n    msg.topic = \"Mission not created, attempting again\";\n    return [msg, null];\n}\nelse { // if mission has failed multiple times -> Lost round\n    msg.mRes = 1; // Mission won by chunguitos\n    msg.topic(\"Mission failed because it has failed 5 times\");\n    return [null, msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":680,"wires":[["a3be3f45.ad6a3","2b68fa6f.2ab936","537db9c1.cec818"],["c9804afe.69d488","6c23cda7.8caae4","537db9c1.cec818"]]},{"id":"6c23cda7.8caae4","type":"function","z":"f3948f39.2753c","name":"Update result of normal Poll","func":"msg.topic = \"UPDATE Missions SET \";\nif (msg.vYes) {\n    msg.topic += \"mRes = \" + msg.mRes + \", vYes = \" + msg.vYes + \", vNo = \" + msg.vNo;\n}\nelse {\n    msg.topic += \"mRes = \" + msg.mRes;\n}\nmsg.topic += \" WHERE mId = \" + msg.currentMission.mId;\n\n// node.warn(msg.topic);\n// node.warn(msg.currentMission.mId);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1280,"y":560,"wires":[["1d33cd2c.065ca3"]]},{"id":"1d33cd2c.065ca3","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Execute query","x":1500,"y":560,"wires":[[]]},{"id":"43fa1d9c.6c34d4","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"INSERT INTO Players ('name') values (\"Jorge\");","name":"Enable next mission","x":1484,"y":800,"wires":[["5b800c91.d729d4"]]},{"id":"c9804afe.69d488","type":"debug","z":"f3948f39.2753c","name":"5 fails making team","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1230,"y":717,"wires":[]},{"id":"a3be3f45.ad6a3","type":"debug","z":"f3948f39.2753c","name":"Fail making team","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1230,"y":625,"wires":[]},{"id":"7d98bc44.d312d4","type":"debug","z":"f3948f39.2753c","name":"team made","active":true,"tosidebar":false,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":520,"wires":[]},{"id":"7ea6e723.6355f8","type":"function","z":"f3948f39.2753c","name":"Invalid response","func":"msg.payload = \"f\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":1080,"wires":[["a53863af.9150a"]]},{"id":"bd4f8fa4.971b6","type":"function","z":"f3948f39.2753c","name":"If state is not the current","func":"let s = parseInt(msg.payload.currentState);\nif (s == -1 || // If I want to reconect\n    s != global.get(\"currentState\")) {\n    // If asked state is current\n    return [msg, null];\n}\nreturn [null, msg]; // if not state is not the current","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":980,"wires":[["525035de.1f9f0c"],["7ea6e723.6355f8"]]},{"id":"bc551642.9bd898","type":"debug","z":"f3948f39.2753c","name":"log debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":320,"y":760,"wires":[]},{"id":"7e07dab8.9dc3e4","type":"function","z":"f3948f39.2753c","name":"Go to Mission","func":"msg.payload = \"missionPoll.html\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":1000,"wires":[["a53863af.9150a"]]},{"id":"9ab92bd6.a226b8","type":"link in","z":"f3948f39.2753c","name":"","links":["cbbbe58f.deb188"],"x":195,"y":700,"wires":[["bc551642.9bd898","7b244997.53cbe8"]]},{"id":"7b244997.53cbe8","type":"function","z":"f3948f39.2753c","name":"Determine poll outcome","func":"let sum = msg.vYes + msg.vNo; \nlet thisMissionRequires2fails = false;\n\nif (msg.currentMission.mId == 4 && sum >= 4) {\n    // If this executes, there're at least 7 playes in =>\n    // 4ยบ mission requires 2 fails.\n    thisMissionRequires2fails = true;\n}\n\nif (msg.vNo == 0 ||\n    (thisMissionRequires2fails && msg.vNo == 1)) {\n    msg.mRes = 0;\n    node.warn(\"Mission won by resistance\");\n} \nelse {\n    msg.mRes = 1;\n    node.warn(\"Mission won by chunguitos\")\n}\ndelete msg.vYes; delete msg.vNo;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":700,"wires":[["6c23cda7.8caae4","537db9c1.cec818","e4b3d4da.18ac88"]]},{"id":"5b800c91.d729d4","type":"function","z":"f3948f39.2753c","name":"Start next round","func":"let STATES = global.get(\"STATES\");\n\nnode.warn(\"Starting new round\");\n\nglobal.set(\"currentState\", STATES.ROUND);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1683,"y":800,"wires":[[]]},{"id":"1fa84c75.0857b4","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"msg.topic","sql":"","name":"Delete failed team","x":1610,"y":660,"wires":[[]]},{"id":"2b68fa6f.2ab936","type":"function","z":"f3948f39.2753c","name":"Create template","func":"msg.topic = \"DELETE FROM MissionTeam WHERE mId = \" + (msg.currentMission.mId + 1); // +1 beacuse already - 1\nnode.warn(\"Deleting failed team:\\n\" +msg.topic);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1420,"y":660,"wires":[["1fa84c75.0857b4"]]},{"id":"a78fcd1.fb22e3","type":"sqlite","z":"f3948f39.2753c","mydb":"a5762d7.f21efd","sqlquery":"fixed","sql":"SELECT * FROM Missions;","name":"Get missions","x":1410,"y":760,"wires":[["7f16269b.a92298"]]},{"id":"3a8e7726.d98b68","type":"function","z":"f3948f39.2753c","name":"Go to gameOver","func":"msg.payload = \"gameOver\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":810,"y":1040,"wires":[["a53863af.9150a"]]},{"id":"60d63eb5.c61ec","type":"http response","z":"f3948f39.2753c","name":"Answer root","statusCode":"","headers":{},"x":810,"y":800,"wires":[]},{"id":"6c3d5f40.1203a","type":"debug","z":"f3948f39.2753c","name":"RootResponse","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":820,"y":760,"wires":[]},{"id":"50dc9c5.12e0964","type":"link out","z":"f3948f39.2753c","name":"teamCreated_in","links":["43778e8f.7cffd","157c194e.395cb7"],"x":575,"y":760,"wires":[]},{"id":"f5ca1af.de7d0e8","type":"link out","z":"f3948f39.2753c","name":"teamFailed","links":["43778e8f.7cffd"],"x":575,"y":800,"wires":[]},{"id":"8e66e204.ff99f","type":"link out","z":"f3948f39.2753c","name":"teamFailedMultipleTimes","links":["43778e8f.7cffd","157c194e.395cb7"],"x":575,"y":840,"wires":[]},{"id":"43778e8f.7cffd","type":"link in","z":"f3948f39.2753c","name":"answerRoot","links":["50dc9c5.12e0964","8e66e204.ff99f","f5ca1af.de7d0e8"],"x":695,"y":800,"wires":[["60d63eb5.c61ec","6c3d5f40.1203a"]]},{"id":"157c194e.395cb7","type":"link in","z":"f3948f39.2753c","name":"updateResultNormalPoll","links":["50dc9c5.12e0964","8e66e204.ff99f"],"x":715,"y":860,"wires":[[]]},{"id":"e4b3d4da.18ac88","type":"link out","z":"f3948f39.2753c","name":"missionPollEnded","links":[],"x":475,"y":740,"wires":[]},{"id":"a5762d7.f21efd","type":"sqlitedb","db":":memory:","mode":"RWC"}]